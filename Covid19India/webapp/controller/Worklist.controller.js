sap.ui.define(["com/sap/dinesh/covid19india/dashboard/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/Device"],function(e,t,o,n,i,r){"use strict";return e.extend("com.sap.dinesh.covid19india.dashboard.controller.Worklist",{onInit:function(){this.getView().setBusy(!0),this.getRouter().getRoute("worklist").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(){this.checkConnection()||this.getRouter().getTargets().display("notFound")},onAfterRendering:function(){this.getData(),this.modelServices(),r.support.touch?this.getView().byId("Tilecontainer").setHeight("100%"):this.getView().byId("Tilecontainer").setHeight("50%")},modelServices:function(){var e=this;e.intervalHandle=setInterval(function(){e.getData()},12e4)},getData:function(){console.clear();var e=[],o=[],n=[],i=[],r=0,s=0,a=[],l=[],c={flag:"https://upload.wikimedia.org/wikipedia/commons/4/45/Terra_globe_icon.png"},d=new t(this.getOwnerComponent().getModel("flagdata").getData());this.getView().setModel(d,"flag");var u=this.getOwnerComponent().getModel("my_global_json_model").getData(),h=new t(this.getOwnerComponent().getModel("my_global_json_model_data_source_country_model").getData());if(u.statewise){l=u.statewise.filter(function(e){return"Total"===e.state});var g=$.extend([],u.statewise);g&&g.sort(function(e,t){return t.recovered-e.recovered});var p=new t;p.setData(g),this.getView().setModel(p,"DatadataCasesdataRecoverd")}if((e=h.getData()).length)var f=e.filter(function(e){return"World"===e.country||"Global"===e.country});var v=new t(f);if(this.getView().setModel(v,"GlobalData"),e.length>0){o=this.getOwnerComponent().getModel("flagdata").getData();for(var w=0;w<e.length;w++)if(r+=Number(e[w].totalTests),s+=Number(e[w].testsPerOneMillion),o.length&&w>6){for(var m=!1,y=0;y<o.length;y++)o[y].country===e[w].country&&(e[w].countryInfo=o[y].countryInfo,m=!0);m||(e[w].countryInfo=c),"World"===e[w].country||"Global"===e[w].country?(e[w].country="Global",e[w].countryInfo=c,a.push(e[w])):("India"===e[w].country&&(l.length&&(e[w].recovered=l[0].recovered),l.length&&(e[w].cases=l[0].confirmed),l.length&&(e[w].active=l[0].active),n.push(e[w])),"Total"!==e[w].country&&"Total:"!==e[w].country&&"India"!==e[w].country&&i.push(e[w]))}}a.length&&(a[0].totalTests=r),a.length&&(a[0].testsPerOneMillion=s),i=(n=a.concat(n)).concat(i),h.setData(i),h.setSizeLimit(i.length),this.getView().setModel(h,"CountryData");var _=$.extend([],i),P=new t;_.length&&_.sort(function(e,t){return t.cases-e.cases}),P.setData(_),P.setSizeLimit(_.length),this.getView().setModel(P,"CountryDataCases");var D=$.extend([],i),C=new t;D.length&&D.sort(function(e,t){return t.recovered-e.recovered}),C.setData(D),C.setSizeLimit(D.length),this.getView().setModel(C,"CountryDataRecovered")},onSearch:function(e){var t=[],n=e.getSource().getValue();n&&n.length>0&&(t=[new o("country",sap.ui.model.FilterOperator.Contains,n)]),e.getSource().getParent().getParent().getBinding("items").filter(t,"Application")},onSearchState:function(e){var t=e.getSource().getValue();if(t&&t.length>0)var n=new sap.ui.model.Filter({filters:[new o("state",sap.ui.model.FilterOperator.Contains,t),new o("statecode",sap.ui.model.FilterOperator.Contains,t)]});e.getSource().getParent().getParent().getBinding("items").filter(n,"Application")},onTileDisplayDetails:function(e){this._oPopover?(this._oPopover.bindElement("CountryData>"+e.getSource().oBindingContexts.CountryData.sPath+"/"),this._oPopover.openBy(e.getSource())):(this._oPopover=sap.ui.xmlfragment("com.sap.dinesh.covid19india.dashboard.view.QuickViewCard",this),this.getView().addDependent(this._oPopover),this._oPopover.bindElement("CountryData>"+e.getSource().oBindingContexts.CountryData.sPath+"/"),this._oPopover.openBy(e.getSource()))},handleClosePressed:function(e){this._oPopover.close()},handleClosePressed_oPopoverHelpfulLinks:function(e){this._oPopoverHelpfulLinks.close()},onExit:function(){this._oPopover&&this._oPopover.destroy(),this._oPopoverHelpfulLinks&&this._oPopoverHelpfulLinks.destroy(),this._oPopoverdIstrictReporting&&this._oPopoverdIstrictReporting.destroy()},onHome:function(){window.open("https://indiaagainstcovid19.in/","_self")},dIstrictReporting:function(e){window.open("https://www.mohfw.gov.in/pdf/Districtreporting408.pdf","_blank")},helpLineNumbers:function(e){window.open("https://www.mohfw.gov.in/pdf/coronvavirushelplinenumber.pdf")},helpfulLinks:function(e){this._oPopoverHelpfulLinks?this._oPopoverHelpfulLinks.openBy(e.getSource()):(this._oPopoverHelpfulLinks=sap.ui.xmlfragment("com.sap.dinesh.covid19india.dashboard.view.HelpFullinks",this),this.getView().addDependent(this._oPopoverHelpfulLinks),this._oPopoverHelpfulLinks.openBy(e.getSource()))}})});
